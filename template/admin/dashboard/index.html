{% extends "base.html" %}

{% block title %}Admin Dashboard - Camera Shop{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
    }
    
    .metric-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
        transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 12px rgba(0,0,0,0.15);
    }
    
    .metric-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }
    
    .metric-value {
        font-size: 2rem;
        font-weight: bold;
        margin: 0.5rem 0;
    }
    
    .metric-label {
        color: #6c757d;
        font-size: 0.875rem;
        margin: 0;
    }
    
    .icon-revenue {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .icon-orders {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
    }
    
    .icon-products {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
    }
    
    .icon-customers {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        color: white;
    }
    
    .icon-pending {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        color: white;
    }
    
    .chart-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
    }
    
    .chart-card h5 {
        margin-bottom: 1.5rem;
        color: #667eea;
        font-weight: 600;
    }
    
    .table-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
    }
    
    .table-card h5 {
        margin-bottom: 1rem;
        color: #667eea;
        font-weight: 600;
    }
    
    .badge-status {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
    }
    
    .alert-card {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
    }
    
    .low-stock-badge {
        background-color: #dc3545;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 8px;
        font-size: 0.75rem;
    }
    
    .time-filter {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }
    
    .time-filter a {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        text-decoration: none;
        background: #f8f9fa;
        color: #667eea;
        transition: all 0.3s;
    }
    
    .time-filter a:hover {
        background: #667eea;
        color: white;
    }
    
    .time-filter a.active {
        background: #667eea;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div class="container">
        <h1>üìä Admin Dashboard</h1>
        <p>T·ªïng quan & Ph√¢n t√≠ch D·ªØ li·ªáu</p>
    </div>
</div>

<div class="container">
    {% if output %}
    <!-- Time Filter -->
    <div class="time-filter">
        <a href="{{ url_for('admin_dashboard.dashboard', days=7) }}" 
           class="{% if days == 7 %}active{% endif %}">7 ng√†y</a>
        <a href="{{ url_for('admin_dashboard.dashboard', days=30) }}" 
           class="{% if days == 30 %}active{% endif %}">30 ng√†y</a>
        <a href="{{ url_for('admin_dashboard.dashboard', days=90) }}" 
           class="{% if days == 90 %}active{% endif %}">90 ng√†y</a>
        <a href="{{ url_for('admin_dashboard.dashboard', days=365) }}" 
           class="{% if days == 365 %}active{% endif %}">1 nƒÉm</a>
    </div>
    
    <!-- Metric Cards -->
    <div class="row">
        <div class="col-md-4 col-lg-2">
            <div class="metric-card">
                <div class="metric-icon icon-revenue">üí∞</div>
                <h3 class="metric-value">{{ "{:,.0f}".format(output.total_revenue) }} ‚Ç´</h3>
                <p class="metric-label">T·ªïng Doanh thu</p>
            </div>
        </div>
        <div class="col-md-4 col-lg-2">
            <div class="metric-card">
                <div class="metric-icon icon-orders">üì¶</div>
                <h3 class="metric-value">{{ output.total_orders }}</h3>
                <p class="metric-label">T·ªïng ƒê∆°n h√†ng</p>
            </div>
        </div>
        <div class="col-md-4 col-lg-2">
            <div class="metric-card">
                <div class="metric-icon icon-products">üì∑</div>
                <h3 class="metric-value">{{ output.total_products }}</h3>
                <p class="metric-label">S·∫£n ph·∫©m</p>
            </div>
        </div>
        <div class="col-md-4 col-lg-2">
            <div class="metric-card">
                <div class="metric-icon icon-customers">üë•</div>
                <h3 class="metric-value">{{ output.total_customers }}</h3>
                <p class="metric-label">Kh√°ch h√†ng</p>
            </div>
        </div>
        <div class="col-md-4 col-lg-2">
            <div class="metric-card">
                <div class="metric-icon icon-pending">‚è≥</div>
                <h3 class="metric-value">{{ output.pending_orders }}</h3>
                <p class="metric-label">ƒê∆°n ch·ªù x√°c nh·∫≠n</p>
            </div>
        </div>
    </div>
    
    <!-- Charts Row 1 -->
    <div class="row">
        <div class="col-md-8">
            <div class="chart-card">
                <h5>üìà Xu h∆∞·ªõng Doanh thu ({{ days }} ng√†y)</h5>
                {% if revenue_chart %}
                    {{ revenue_chart|safe }}
                {% else %}
                    <p class="text-muted text-center">Kh√¥ng c√≥ d·ªØ li·ªáu doanh thu</p>
                {% endif %}
            </div>
        </div>
        <div class="col-md-4">
            <div class="chart-card">
                <h5>üéØ Tr·∫°ng th√°i ƒê∆°n h√†ng</h5>
                {% if status_chart %}
                    {{ status_chart|safe }}
                {% else %}
                    <p class="text-muted text-center">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë∆°n h√†ng</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Charts Row 2 -->
    <div class="row">
        <div class="col-md-6">
            <div class="chart-card">
                <h5>üè∑Ô∏è Doanh thu theo Danh m·ª•c</h5>
                {% if category_chart %}
                    {{ category_chart|safe }}
                {% else %}
                    <p class="text-muted text-center">Kh√¥ng c√≥ d·ªØ li·ªáu danh m·ª•c</p>
                {% endif %}
            </div>
        </div>
        <div class="col-md-6">
            <div class="chart-card">
                <h5>üèÜ Top 10 S·∫£n ph·∫©m B√°n ch·∫°y</h5>
                {% if top_products_chart %}
                    {{ top_products_chart|safe }}
                {% else %}
                    <p class="text-muted text-center">Kh√¥ng c√≥ d·ªØ li·ªáu s·∫£n ph·∫©m</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Tables Row -->
    <div class="row">
        <div class="col-md-6">
            <div class="table-card">
                <h5>üìã ƒê∆°n h√†ng G·∫ßn ƒë√¢y</h5>
                {% if output.recent_orders %}
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>M√£ ƒë∆°n</th>
                            <th>Kh√°ch h√†ng</th>
                            <th>T·ªïng ti·ªÅn</th>
                            <th>Tr·∫°ng th√°i</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in output.recent_orders %}
                        <tr>
                            <td><a href="{{ url_for('admin_orders.order_detail', order_id=order.order_id) }}">#{{ order.order_id }}</a></td>
                            <td>{{ order.customer_name }}</td>
                            <td>{{ "{:,.0f}".format(order.total) }} ‚Ç´</td>
                            <td>
                                {% if order.status == 'CHO_XAC_NHAN' %}
                                <span class="badge bg-warning">Ch·ªù x√°c nh·∫≠n</span>
                                {% elif order.status == 'DANG_GIAO' %}
                                <span class="badge bg-info">ƒêang giao</span>
                                {% elif order.status == 'HOAN_THANH' %}
                                <span class="badge bg-success">Ho√†n th√†nh</span>
                                {% elif order.status == 'DA_HUY' %}
                                <span class="badge bg-danger">ƒê√£ h·ªßy</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <a href="{{ url_for('admin_orders.list_orders') }}" class="btn btn-sm btn-primary">Xem t·∫•t c·∫£ ‚Üí</a>
                {% else %}
                <p class="text-muted text-center">Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o</p>
                {% endif %}
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="table-card">
                <h5>‚ö†Ô∏è C·∫£nh b√°o T·ªìn kho Th·∫•p</h5>
                {% if output.low_stock_products %}
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>S·∫£n ph·∫©m</th>
                            <th>Danh m·ª•c</th>
                            <th>T·ªìn kho</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in output.low_stock_products[:10] %}
                        <tr>
                            <td>{{ product.name }}</td>
                            <td>{{ product.category }}</td>
                            <td>
                                <span class="low-stock-badge">{{ product.stock }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="alert alert-success">
                    <strong>‚úì T·ªët!</strong> T·∫•t c·∫£ s·∫£n ph·∫©m ƒë·ªÅu c√≥ ƒë·ªß t·ªìn kho
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    {% else %}
    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu dashboard</strong><br>
        Vui l√≤ng th·ª≠ l·∫°i sau ho·∫∑c li√™n h·ªá qu·∫£n tr·ªã vi√™n h·ªá th·ªëng.
    </div>
    {% endif %}
    
    <!-- Quick Actions -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="chart-card">
                <h5>‚ö° Thao t√°c Nhanh</h5>
                <div class="d-flex gap-2 flex-wrap">
                    <a href="{{ url_for('admin_orders.list_orders') }}" class="btn btn-primary">
                        üì¶ Qu·∫£n l√Ω ƒê∆°n h√†ng
                    </a>
                    <a href="{{ url_for('admin.products') }}" class="btn btn-success">
                        üì∑ Qu·∫£n l√Ω S·∫£n ph·∫©m
                    </a>
                    <a href="{{ url_for('admin.users') }}" class="btn btn-info">
                        üë• Qu·∫£n l√Ω Kh√°ch h√†ng
                    </a>
                    <a href="{{ url_for('admin.categories') }}" class="btn btn-warning">
                        üè∑Ô∏è Qu·∫£n l√Ω Danh m·ª•c
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-refresh stats every 5 minutes
    setInterval(function() {
        fetch('{{ url_for("admin_dashboard.quick_stats") }}')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Dashboard stats refreshed');
                }
            })
            .catch(error => console.error('Error refreshing stats:', error));
    }, 300000); // 5 minutes
</script>
{% endblock %}
