{% extends "admin/base.html" %}

{% block title %}Chỉnh sửa Thương hiệu - Admin{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="mb-4">
        <h2 class="mb-0">✏️ Chỉnh sửa Thương hiệu</h2>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('admin_brands.list_brands') }}">Thương hiệu</a></li>
                <li class="breadcrumb-item active">Chỉnh sửa #{{ brand.id }}</li>
            </ol>
        </nav>
    </div>

    <!-- Form -->
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('admin_brands.edit_brand', brand_id=brand.id) }}">
                        <!-- Brand Name -->
                        <div class="mb-3">
                            <label for="name" class="form-label">
                                Tên Thương hiệu <span class="text-danger">*</span>
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="name" 
                                   name="name" 
                                   value="{{ brand.name }}"
                                   required 
                                   minlength="2"
                                   maxlength="100">
                            <div class="form-text">Tối thiểu 2 ký tự, tối đa 100 ký tự</div>
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label for="description" class="form-label">Mô tả</label>
                            <textarea class="form-control" 
                                      id="description" 
                                      name="description" 
                                      rows="4">{{ brand.description }}</textarea>
                        </div>

                        <!-- Logo URL -->
                        <div class="mb-4">
                            <label for="logo_url" class="form-label">Logo URL</label>
                            <input type="url" 
                                   class="form-control" 
                                   id="logo_url" 
                                   name="logo_url"
                                   value="{{ brand.logo_url }}"
                                   onchange="previewLogo(this.value)">
                            <div class="form-text">Nhập URL của logo thương hiệu (không bắt buộc)</div>
                            
                            <!-- Current Logo -->
                            {% if brand.logo_url %}
                            <div class="mt-3">
                                <label class="form-label">Logo hiện tại:</label>
                                <div class="border p-3 rounded text-center bg-light">
                                    <img src="{{ brand.logo_url }}" 
                                         alt="{{ brand.name }}" 
                                         style="max-width: 200px; max-height: 100px; object-fit: contain;"
                                         onerror="this.src='https://via.placeholder.com/200x100?text=Invalid+URL'">
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Logo Preview -->
                            <div id="logoPreview" class="mt-3" style="display: none;">
                                <label class="form-label">Xem trước logo mới:</label>
                                <div class="border p-3 rounded text-center bg-light">
                                    <img id="previewImage" 
                                         src="" 
                                         alt="Logo preview" 
                                         style="max-width: 200px; max-height: 100px; object-fit: contain;">
                                </div>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('admin_brands.list_brands') }}" 
                               class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Quay lại
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Cập nhật Thương hiệu
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border: none;
}

.form-label {
    font-weight: 600;
    color: #2c3e50;
}

.form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}
</style>

<script>
function previewLogo(url) {
    const preview = document.getElementById('logoPreview');
    const img = document.getElementById('previewImage');
    
    if (url && url.trim() !== '' && url !== '{{ brand.logo_url }}') {
        img.src = url;
        preview.style.display = 'block';
        
        // Handle image load error
        img.onerror = function() {
            img.src = 'https://via.placeholder.com/200x100?text=Invalid+URL';
        };
    } else {
        preview.style.display = 'none';
    }
}
</script>
{% endblock %}
